syntax = "proto3";
package table_api;

service TableService {
  rpc GetTableList(Void) returns (TableList);
  rpc CreateTable(TableMetadata) returns (Void);
  rpc DropTable(Table) returns (Void);
  rpc DeleteTable(Table) returns (Void);
  
  rpc CreateBackup(Table) returns (Void);
  rpc Export(Table) returns (Void);

  //rpc AddColumn() returns (Void);
  //rpc DeleteColumn() returns (Void);
  //rpc ChangeColumn() returns (Void);
  
  rpc SelectRecords(SelectRequest) returns (RecordsInfo);
  rpc AddRecords(AddRequest) returns (Void);
  rpc DeleteRecords(DeleteRequest) returns (Void);
  rpc ChangeRecords(ChangeRequest) returns (Void);
}

enum Type {
  string = 0;
  i32 = 1;
  u64 = 2;
  bool = 3;
  f32 = 4;
  f64 = 5;
  i8 = 6;
  i16 = 7;
  i64 = 8;
  u8 = 9;
  u16 = 10;
  u32 = 11;
}

enum Filter {
  equal = 0;
  less = 1;
  greater = 2;
  less_eq = 3;
  greater_eq = 4;
  contains = 5;
  starts_with = 6;
  ends_with = 7;
}

message Table {
  string name = 1;
}

message TableList {
  repeated Table tables = 1;
}

message Field {
  string name = 1;
  Type type = 2;
}

message TableMetadata {
  string name = 1;
  repeated Field fields = 2;
  int32 primary_key = 3;
  repeated int32 indexes = 4;
}

message FilterOption {
  Field column = 1;
  Filter filter = 2;
}

message Value {
  oneof kind {
    uint32 u8 = 1;
    uint32 u16 = 2;
    uint32 u32 = 3;
    uint64 u64 = 4;
    int32 i8 = 5;
    int32 i16 = 6;
    int32 i32 = 7;
    int64 i64 = 8;
    bool bool = 9;
    float f32 = 10;
    double f64 = 11;
  }
}

message ValueSequence {
  repeated Value sequence = 1;
}

message RecordsInfo {
  repeated ValueSequence records = 1;
}

message AddRequest {
  Table table = 1;
  RecordsInfo records = 2;
}

// select limit filter order ?? group by, distinct
message SelectRequest {
  Table table = 1;
  repeated FilterOption filters = 3;
}

message DeleteRequest {
  Table table = 1;
  repeated FilterOption filters = 3;
}

message ChangeRequest {
  Table table = 1;
  repeated Field pattern = 2;
  ValueSequence new_values = 3;
  repeated FilterOption filters = 4;
}

message Void {}
